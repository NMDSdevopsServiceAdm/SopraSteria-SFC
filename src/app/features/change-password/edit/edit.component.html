<app-error-summary
  *ngIf="submitted && form.invalid"
  [formErrorsMap]="formErrorsMap"
  [form]="form"
  [serverError]="serverError"
>
</app-error-summary>

<span class="govuk-caption-m govuk-!-margin-bottom-2">Account</span>
<h1 class="govuk-heading-l govuk-!-margin-bottom-7">Change password</h1>
<p class="govuk-!-margin-bottom-7">Change password for account {{ userDetails.username }}</p>

<form novalidate (ngSubmit)="onSubmit()" [formGroup]="form" id="server-error">
  <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && getOldPasswordInput.errors">
    <label class="govuk-label" for="oldPasswordInput">
      Password
    </label>
    <span *ngIf="submitted && getOldPasswordInput.errors" id="oldPasswordInput-error" class="govuk-error-message">
      <span class="govuk-visually-hidden">Error:</span> {{ getFormErrorMessage('oldPasswordInput', 'required') }}
    </span>
    <input
      class="govuk-input"
      formControlName="oldPasswordInput"
      id="oldPasswordInput"
      name="oldPasswordInput"
      [class.govuk-input--error]="submitted && getOldPasswordInput.errors"
      placeholder=""
      type="password"
    />
  </div>

  <div formGroupName="passwordGroup">
    <div class="govuk-form-group" [class.govuk-form-group--error]="submitted && getCreatePasswordInput.errors">
      <label class="govuk-label" for="createPasswordInput">
        New password
      </label>
      <span id="createPasswordInput-hint" class="govuk-hint">
        This must be at least 8 characters, contain one uppercase and one lowercase letter and a number
      </span>
      <span *ngIf="submitted" id="createPasswordInput-error" class="govuk-error-message">
        <span class="govuk-visually-hidden">Error:</span>
        <span *ngIf="getCreatePasswordInput.hasError('required')">
          {{ getFormErrorMessage('createPasswordInput', 'required') }}
        </span>
        <span *ngIf="getCreatePasswordInput.hasError('pattern')">
          {{ getFormErrorMessage('createPasswordInput', 'pattern') }}
        </span>
      </span>
      <input
        aria-describedby="createPasswordInput-hint"
        class="govuk-input"
        formControlName="createPasswordInput"
        id="createPasswordInput"
        name="createPasswordInput"
        [class.govuk-input--error]="submitted && getCreatePasswordInput.errors"
        placeholder=""
        type="password"
      />
    </div>

    <div
      class="govuk-form-group govuk-!-margin-bottom-8"
      [class.govuk-form-group--error]="submitted && getConfirmPasswordInput.errors"
    >
      <label class="govuk-label" for="confirmPasswordInput">
        Confirm password
      </label>
      <span *ngIf="submitted" id="confirmPasswordInput-error" class="govuk-error-message">
        <span class="govuk-visually-hidden">Error:</span>
        <span
          *ngIf="getConfirmPasswordInput.hasError('required') || getConfirmPasswordInput.hasError('notMatched')"
          id="passwordGroup-error"
        >
          {{ getFormErrorMessage('confirmPasswordInput', 'required') }}
        </span>
      </span>
      <input
        class="govuk-input"
        formControlName="confirmPasswordInput"
        id="confirmPasswordInput"
        name="confirmPasswordInput"
        [class.govuk-input--error]="submitted && getConfirmPasswordInput.errors"
        placeholder=""
        type="password"
      />
    </div>
  </div>

  <button class="govuk-button" type="submit">Save new password</button>
</form>
