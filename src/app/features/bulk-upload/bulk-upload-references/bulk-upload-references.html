<!-- TODO check if needed
<button (click)="updateReferences()">Update References</button>

<ng-container *ngIf="referencesUpdated">
 <p>Settings updated</p>
 <p>
   <a [routerLink]="['/bulk-upload']">Go to Bulk Upload</a>
 </p>
</ng-container>
TODO check if needed -->

<app-error-summary
  *ngIf="(submitted && form.invalid) || serverError"
  [serverError]="serverError"
  [formErrorsMap]="formErrorsMap"
  [form]="form"
></app-error-summary>

<app-dashboard-header></app-dashboard-header>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <p class="govuk-caption-l govuk-!-margin-bottom-0">{{ primaryEstablishmentName }}</p>
    <h1 class="govuk-heading-l">{{ referenceType }} references</h1>
    <p>{{ referenceTypeInfo }}</p>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <form
      class="govuk-!-margin-top-6"
      *ngIf="references.length"
      novalidate
      (ngSubmit)="onSubmit(true)"
      [formGroup]="form"
      id="server-error"
    >
      <div class="govuk__grid govuk__grid-container">
        <ng-container *ngIf="referenceType === referenceTypeEnum.Worker">
          <h2 class="govuk-heading-m govuk__reference-subsidiary-name">{{ establishmentName }}</h2>
          <p class="govuk-!-margin-0 govuk__justify-self-end">
            <strong>{{ remainingEstablishments }}</strong> workplaces remaining
          </p>
        </ng-container>
        <p class="govuk-!-margin-bottom-0"><strong>{{ columnOneLabel }}</strong></p>
        <p class="govuk-!-margin-bottom-0">
          <strong>{{ columnTwoLabel }}</strong>
        </p>
      </div>

      <div
        class="govuk-form-group govuk__grid govuk__grid-container"
        *ngFor="let reference of references"
        [class.govuk-form-group--error]="form.get('name-' + reference.uid).errors && submitted"
        [ngClass]="form.get('name-' + reference.uid).errors && submitted ? 'govuk__grid-two-rows' : 'govuk__grid-one-row'"
      >
        <label class="govuk-label govuk-!-margin-bottom-0" for="name-{{ reference.uid }}">
          {{ reference.name ? reference.name : reference.nameOrId }}
        </label>
        <span
          id="name-{{ reference.uid }}-error"
          class="govuk-error-message govuk__grid-row-start-1 govuk__reference-grid-error"
          *ngIf="form.get('name-' + reference.uid).errors && submitted"
        >
          <span class="govuk-visually-hidden">Error:</span> {{ getFirstErrorMessage('name-' + reference.uid) }}
        </span>
        <input
          class="govuk-input"
          [class.govuk-input--error]="form.get('name-' + reference.uid).errors && submitted"
          id="name-{{ reference.uid }}"
          name="name-{{ reference.uid }}"
          type="text"
          formControlName="name-{{ reference.uid }}"
          [value]="reference.localIdentifier"
        />
        <p
          class="govuk-!-margin-bottom-0 govuk__justify-self-end"
          *ngIf="referenceType === referenceTypeEnum.Establishment"
        >
          <a [routerLink]="['/bulk-upload/staff-references', reference.uid]">Staff references</a>
        </p>
      </div>
    </form>

    <p *ngIf="!references.length">There are no workplaces.</p>

    <div class="govuk-grid-row" *ngIf="references.length">
      <div class="govuk-grid-column-full">
        <div class="govuk-button-group">
          <button
            type="button"
            class="govuk-button govuk-!-margin-right-8 govuk-!-margin-bottom-0"
            (click)="onSubmit(true)"
          >
            Save and continue
          </button>
          <span class="govuk-visually-hidden">or</span>
          <button
            type="button"
            class="govuk-button govuk-button--link govuk-!-margin-bottom-0"
            (click)="onSubmit(false)"
          >
            Save and exit
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
